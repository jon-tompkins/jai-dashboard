{
  "taskName": "Myjunto Tweet Freshness Fix",
  "taskId": "myjunto-tweet-freshness-fix",
  "content": "# MyJunto Tweet Freshness Fix - Complete Resolution\n\n## üîç Root Cause Analysis\n\nThe newsletter content was stale because **the tweet ingestion infrastructure was never deployed**. The database was missing three critical tables:\n\n| Missing Table | Purpose |\n|--------------|---------|\n| `profiles` | Stores Twitter accounts being tracked |\n| `tweets` | Stores fetched tweets from those accounts |\n| `user_profiles` | Links users to profiles they want to follow |\n\nWithout these tables:\n- Tweet fetching silently failed (no place to store tweets)\n- Newsletter generation found 0 tweets to synthesize\n- Newsletters were empty or used old cached content\n\nAdditionally, there were schema mismatches:\n- `newsletters` table used `title` but code expected `subject`\n- `users` table missing `twitter_handle` and `has_access` columns\n\n## ‚úÖ What I Fixed\n\n### 1. Created Database Migration\n**File:** `junto/migrations/002_tweet_freshness_fix.sql`\n\nThis migration:\n- Creates `profiles`, `tweets`, `user_profiles` tables\n- Adds missing columns to `users` table (`twitter_handle`, `has_access`)\n- Adds missing columns to `newsletters` table for proper tracking\n- Seeds initial profiles (crypto_condom, cburniske, krugman87)\n- Sets up Jon's user with access and profile links\n- Enables RLS policies\n\n### 2. Fixed Config File\n**File:** `junto/src/lib/utils/config.ts`\n\nAdded Twitter proxy configuration support:\n```typescript\ntwitter: {\n  proxyUrl: getEnvVar('TWITTER_PROXY_URL', false),\n  proxyToken: getEnvVar('TWITTER_PROXY_TOKEN', false),\n},\n```\n\n## üìã Jon's Action Items\n\n### Step 1: Run Database Migration (5 minutes)\n\n1. Go to Supabase SQL Editor:\n   https://supabase.com/dashboard/project/lsqlqssigerzghlxfxjl/sql/new\n\n2. Copy the entire contents of `junto/migrations/002_tweet_freshness_fix.sql`\n\n3. Paste and run in the SQL editor\n\n4. Verify success - you should see:\n   - 3 profiles created\n   - Your user with `has_access = true`\n   - User-profile mappings for your account\n\n### Step 2: Configure Twitter Proxy (Required!)\n\nThe app needs a Twitter proxy to fetch tweets. You need to set these in Vercel:\n\n1. Go to Vercel Dashboard ‚Üí myjunto ‚Üí Settings ‚Üí Environment Variables\n\n2. Add these variables:\n   ```\n   TWITTER_PROXY_URL=<your-twitter-proxy-url>\n   TWITTER_PROXY_TOKEN=<your-proxy-auth-token>\n   ```\n\n**Don't have a Twitter proxy?** You need one. Options:\n- **Apify Twitter Scraper**: https://apify.com/quacker/twitter-scraper\n- **RapidAPI Twitter API**: https://rapidapi.com/category/Social\n- **Self-hosted Nitter**: https://github.com/zedeus/nitter\n\nThe proxy should accept requests like:\n```\nGET ${TWITTER_PROXY_URL}/tweets?handle=crypto_condom&count=30\nAuthorization: Bearer ${TWITTER_PROXY_TOKEN}\n```\n\nAnd return:\n```json\n{\n  \"success\": true,\n  \"handle\": \"crypto_condom\",\n  \"count\": 15,\n  \"tweets\": [\n    {\n      \"id\": \"123...\",\n      \"text\": \"...\",\n      \"createdAt\": \"2024-01-15T10:30:00Z\",\n      \"likeCount\": 100,\n      \"retweetCount\": 20\n    }\n  ]\n}\n```\n\n### Step 3: Redeploy (2 minutes)\n\nAfter adding env vars, trigger a redeploy:\n1. Go to Vercel Dashboard ‚Üí myjunto ‚Üí Deployments\n2. Click \"...\" on latest deployment ‚Üí Redeploy\n\n### Step 4: Test Tweet Fetching\n\nCall the tweet fetch endpoint:\n```bash\ncurl -X POST https://www.myjunto.xyz/api/tweets/fetch \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"seed\": false}'\n```\n\nExpected response:\n```json\n{\n  \"success\": true,\n  \"profiles\": 3,\n  \"results\": {\n    \"crypto_condom\": { \"fetched\": 30, \"stored\": 25 },\n    \"cburniske\": { \"fetched\": 15, \"stored\": 15 },\n    \"krugman87\": { \"fetched\": 10, \"stored\": 10 }\n  }\n}\n```\n\n### Step 5: Verify Newsletter Generation\n\nGenerate a test newsletter:\n```bash\ncurl -X POST https://www.myjunto.xyz/api/newsletter/generate \\\n  -H \"Content-Type: application/json\"\n```\n\nThis should now find tweets and create a fresh newsletter!\n\n## üß™ Multi-User Profile Tracking\n\nThe system now supports multiple users tracking multiple profiles:\n\n**Schema:**\n```\nusers (1) --< user_profiles >-- (many) profiles (1) --< tweets\n```\n\n**How it works:**\n1. Each user selects profiles via `/api/user/profiles`\n2. Cron job fetches tweets for ALL profiles that ANY user follows\n3. Newsletter generation filters tweets to only the user's selected profiles\n4. Each user gets a personalized newsletter\n\n**Scaling considerations:**\n- Tweet fetching is deduplicated (each profile fetched once even if multiple users follow)\n- Tweets stored once, queried per-user\n- Add more profiles via the `profiles` table; link users via `user_profiles`\n\n## üìÅ Files Changed\n\n```\njunto/\n‚îú‚îÄ‚îÄ migrations/\n‚îÇ   ‚îú‚îÄ‚îÄ 001_add_tweet_tables.sql     # Initial migration (unused)\n‚îÇ   ‚îî‚îÄ‚îÄ 002_tweet_freshness_fix.sql  # COMPLETE MIGRATION - RUN THIS\n‚îî‚îÄ‚îÄ src/lib/utils/\n    ‚îî‚îÄ‚îÄ config.ts                     # Added twitter proxy config\n```\n\n## üö® Critical: Without Twitter Proxy\n\nIf no Twitter proxy is configured, the system will:\n- Fail to fetch any tweets\n- Log errors in the console\n- Generate newsletters with 0 tweets (stale/empty content)\n\n**You MUST configure a Twitter data source** (proxy URL + token) for fresh content.\n\n## Expected Timeline\n\n| Step | Time |\n|------|------|\n| Run migration | 2-3 min |\n| Configure env vars | 5 min |\n| Redeploy | 2-3 min |\n| Test & verify | 5 min |\n| **Total** | **~15 min** |\n\n## Questions?\n\nIf you encounter issues:\n1. Check Vercel function logs for errors\n2. Verify env vars are set correctly\n3. Test the proxy endpoint directly with curl\n4. Check Supabase for data in the new tables\n\n---\n\n**Status: Ready for deployment** ‚úÖ\n",
  "deliverableFiles": [
    {
      "name": "002_tweet_freshness_fix.sql",
      "type": "file"
    }
  ],
  "lastModified": "2026-02-03T06:11:45.391Z"
}